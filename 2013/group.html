<!DOCTYPE html>
<html lang='en' style= 'background-color:#00FFFF; padding: 20px 50px 50px'>
<head>

    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojo/resources/dojo.css">
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojox/grid/resources/claroGrid.css">
        
    <!-- <link rel="stylesheet" href="../../_static/js/dojo/../dijit/themes/claro/claro.css"> -->
    <style type="text/css">@import "http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojox/grid/resources/claroGrid.css";
        #parameterGridDiv 
        {
            height: 20em;
            width: 30%;
        }
    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojo/dojo.js" data-dojo-config="async: true, isDebug: true">
    </script>

    <script>require(['dojo/_base/lang', 
        'dojox/grid/DataGrid' , 
        'dojo/data/ItemFileWriteStore' ,
        'dojo/_base/xhr', 
        'dojo/dom' , 
        'dojo/domReady!'],
      function(lang, DataGrid, ItemFileWriteStore, xhr, dom)
        {
            var fields = new Array();
            var has_loaded = false;
            /*set up data store*/

            //Get the parameters from the db
            function getFields()
                {
                    xhr.get(
                    {
                        url:'/group',
                        handleAs: 'json', //grabs the xhr string and turns it into an object
                        content:
                        {
                            action: 'getFields',
                            loaded: has_loaded = true,
                        },
                        load:function(response)
                        {
                            fields = response;
                            buildParameterGrid(fields); //rebuild the dojo Grid
                        },
                        error:function(error)
                        {
                            console.log("There was an error: " + error);
                            dom.byId("serverResponse").innerHTML = 'Response: ' + error;
                        }
                    });
                }

            getFields();    

            //Build the Dojo Grid with the 
            function buildParameterGrid(fields)
            {
                var data = 
                {
                  identifier: "id",
                  items: []
                };
                var data_list = [];
                for(i=0;i<fields.length;i++)
                {
                  data_list[i] = {col1: 'id', col2: fields[i].field_name}
                  console.log('\nfield_name: '+fields[i].field_name +'\nDatalist: ' + data_list[i].col2);
                }
                var rows = fields.length;
                for(var i = 0; i < rows; i++)
                {
                  data.items.push(lang.mixin({ id: i }, data_list[i]));
                }
                var store = new ItemFileWriteStore({data: data});

                /*set up layout*/
                var layout = [[
                  {'name': '#', 'field': 'id', 'width': '25px'},
                  {'name': 'Field', 'field': 'col2',},
                  // {'name': 'Add', 'field': 'col3', 'width': '15px', 'editable': 'true'}
                  {'name': 'Add', 'type': 'dojox.grid.cells.Bool', 'editable': 'true'}
                ]];

                /*create a new grid*/
                var grid = new DataGrid({
                    id: 'grid',
                    store: store,
                    structure: layout,
                    autoWidth: true,
                    autoHeigth: true,
                    rowSelector: '20px'});

                /*append the new grid to the div*/
                grid.placeAt("parameterGridDiv");

                /*Call startup() to render the grid*/
                grid.startup();

                var item = grid.getItem(2);
                var item2;
                if(item)
                    item2 = item.col2;

                console.log('\n- - - - - - - item: ' + item + 'item2: ' + item2 + '- - - - - - -');
            }


            // if(dom.byId("parameterGridDiv").Add.value == true)
            //     console.log("\n----Holy Shmoly----\n");

            
        });
</script>
</head>
<body class="claro">
    <div id="parameterGridDiv" style="float: left"></div>
    <div id="serverResponse"></div>
</body>
</html>