<!DOCTYPE html>
<!-- This code was written by Alex Stout for Goal Zero, LLC private use -->
<html lang='en' style= 'background-color:#00FFFF; padding: 0px 25px 25px'>
<head>
    <title>Parameter: Group</title>
    <h1 ALIGN = 'center' style = 'padding: 10px'> Parameter: Group </h1>

    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojo/resources/dojo.css">
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojox/grid/resources/claroGrid.css">
        
    <style type="text/css">@import "http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojox/grid/resources/claroGrid.css";
        #ParamGrid 
        {
            height: 49.5em;
            width: 100%;
        }
        #selectionGrid 
        {
            height: 55em;
            width: 100%;
        }
        #GroupGridDiv 
        {
            height: 55em;
            width: 100%;
        }
        /*#standardMemGrid 
        {
            height: 23em;
            width: 100%;
        }
        #reportMemGrid 
        {
            height: 23em;
            width: 100%;
        }*/
        #membersGrid
        {
            height: 49.5em;
            width: 100%;
        }
        .dojoxGridMasterView
        {
            font-size: 8pt;
        }
        .dojoxGridMasterHeader
        {
            font-size: 8pt;
        }
    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojo/dojo.js" data-dojo-config="async: true, isDebug: true">
    </script>

    <!-- Dojo Execution -->
    <script>
    require(['dojo/_base/lang', 
        'dojox/grid/DataGrid' , 
        'dojo/data/ItemFileWriteStore',
        "dojo/_base/array",
        'dijit/registry',
        'dojo/_base/xhr', 
        'dojox/grid/_CheckBoxSelector',
        'dijit/form/RadioButton',
        'dijit/form/Select',
        "dijit/form/Button",
        "dijit/form/TextBox",
        'dojo/store/Observable',
        'dojo/store/Memory',
        'dojo/data/ObjectStore',
        'dojo/dom' , 
        'dojo/domReady!'],
        function(lang, DataGrid, ItemFileWriteStore, baseArray, registry, xhr, _CheckBoxSelector, RadioButton, Select, Button, TextBox, Observable, Memory, ObjectStore, dom)
        {
            var fields = new Array();
            var has_loaded = false;

            /*  CREATE A DATA STORE TO CONTAIN ALL THE CONTENT OF THE SERVER  */
            var fullDbMemStore = new Memory({data: new Array()});
                fullDbMemStore = Observable(fullDbMemStore);
                var fullDataStore = new ObjectStore({
                    objectStore: fullDbMemStore
                });
            window.fullDbMemStore = fullDbMemStore; //MAKE IT GLOBAL

            var paramStore = new Memory({data: new Array()});
                paramStore = Observable(paramStore);
            var paramDataStore = new ObjectStore({
                objectStore: paramStore
            });

            window.paramStore = paramStore;
            window.paramDataStore = paramDataStore;

            var membersStore = new Memory({data: new Array(), idProperty: '_id'});
                membersStore = Observable(membersStore);
            var membersDataStore = new ObjectStore({
                objectStore: membersStore
            });

            window.membersStore = membersStore;
            window.membersDataStore = membersDataStore;

            // var reportMemStore = new Memory({data: new Array(), idProperty: '_id'});
            //     reportMemStore = Observable(reportMemStore);
            //     var reportDataStore = new ObjectStore({
            //         objectStore: reportMemStore
            //     });

            // window.reportMemStore = reportMemStore;
            // window.reportDataStore = reportDataStore;

            // var standardMemStore = new Memory({data: new Array(), idProperty: '_id'});
            //     standardMemStore = Observable(standardMemStore);
            //     var standardDataStore = new ObjectStore({
            //         objectStore: standardMemStore
            //     });

            // window.standardMemStore = standardMemStore;
            // window.standardDataStore = standardDataStore;

            /*  FUNCTION TO GET ALL THE DB DATA AND FILL THE DATA STORE  */
            GetFullDbStore = function()
            {
                xhr.get(
                {
                    url:'/global',
                    handleAs: 'json',
                    content:
                    {
                        action: 'getAll',
                        loaded: has_loaded = true,
                    },
                    load: function(response)
                    {
                        fullDbMemStore.data = response;
                        BuildGrids();
                    },
                    error: function(error)
                    {
                        var msg = 'There was an error getting the db. Error: ' + error;
                        dom.byId("serverResponse").innerHTML = 'Response: ' + msg;
                        console.log(msg);
                    }
                });
            }

            /*  BUILDS THE GRIDS USING THE COLLECTED AND ORGANIZED DATA  */
            function BuildGrids()
            {
                var groups = GroupGrid.getGroups();
                GroupGrid.buildGrid(groups);

                ParamGrid.buildGrid();

                SelectionGrid.buildGrid(new Array());

                // ReportMembersGrid.buildGrid(new Array());

                // StandardMembersGrid.buildGrid(new Array());

                MembersGrid.buildGrid(new Array());
                
                dom.byId('txtBox_groupName').value = '';
            }


            /********************************     Group Grid      *********************************/

            var GroupGrid = new Object();

            //GET AND RETURN THE GROUPS FROM THE STORE
            GroupGrid.getGroups = function()
            {
                var groups = fullDbMemStore.query({type: 'param_group'});
                return groups;
            }

            //BUILD THE DOJO GRID WITH THE GIVEN ARRAY OF GROUPS
            GroupGrid.buildGrid = function(groups)
            {
                //DEFINE THE LAYOUT
                var layout = [[
                  {'name': 'Group', 'field': 'name', 'width': '100%'},
                ]];

                //ALLOCATE THE STORE
                var GroupMemStore = new Memory({data: new Array()}); //set up the store
                GroupMemStore = Observable(GroupMemStore);
                var GroupDataStore = new ObjectStore({
                    objectStore: GroupMemStore
                });
                
                //Fill the store with the retrieved DB data
                for(var i = 0; i < groups.length; i++)
                {
                    GroupMemStore.put(lang.mixin(
                        { id: i }, 
                        groups[i]
                    ));
                }

                /*create a new grid*/
                var grid = new DataGrid({
                    store: GroupDataStore,
                    structure: layout,
                    selectionMode: 'single',
                    }, 'GroupGridDiv');
                grid.startup(); //RENDER

                dojo.connect(GroupMemStore, 'notify', function(){grid._refresh()});
                

                //UPDATE THE GROUP SELECTION AND DISPLAY IT IN THE RESPONSE DIV
                function reportSelection(node)
                {
                    //STORE THE SELECTED ITEMS
                    var groups = this.selection.getSelected();
                    GroupGrid.selected_groups = groups;

                    //GET THE PIs OF THE SELECTED GROUP & REBUILD THE SELECTION STORE
                    var parameters = GroupGrid.getFieldsOfGroups(groups);
                    SelectionGrid.rebuildStore(parameters);

                    /*  DISPLAY WHAT'S SELECTED IN THE PROMPT  */
                    if(groups.length < 1)
                        return;

                    var msg = "You have selected " + ((groups.length > 1) ? " ": " ");
                    //FOR EACH PG IN GROUPS, GET THE PG_NAME AND PUT IT IN AN ARRAY 
                    var names = [];
                    for(var i = 0; i < groups.length; i++)
                    {
                        if(!groups[i])
                            return;
                        names.push(groups[i].name);
                    }

                    //UPDATE RESPONSE DIV
                    node.innerHTML = msg + names.join(", ");
                }
                
                //On selection change, call reportSelection() and pass in the response dom
                grid.on("SelectionChanged", 
                    lang.hitch(grid, reportSelection, dom.byId("serverResponse")), true);


                //MAP THE BACKSPACE AND DELETE KEYS TO THE DELETE GROUP BUTTON
                dojo.connect(grid,"onKeyUp", function(e)
                {
                    if(e.keyCode == 46 || e.keyCode == 8)
                    {
                        button_delete_group.onClick();
                    }
                });

                //make the following properties global
                window.GroupData = GroupMemStore.data;
                window.groupGrid = grid;
                window.GroupDataStore = GroupDataStore;
                window.GroupMemStore = GroupMemStore;
            }


            GroupGrid.new_pg = function(pg)
            {
                //send request to create a new PG
                xhr.get(
                {
                    url:"/group", 
                    handleAs: 'json',
                    content: 
                    {
                        action: 'new_pg',
                        pg: JSON.stringify(pg),
                        loaded: has_loaded=true,
                    },
                    load:function(response)
                    {
                        if(objectIsEmpty(response))
                        {
                            dom.byId("serverResponse").innerHTML = "Response from server: " + pg.name + " Already Exists.";
                            return;
                        }
                        dom.byId("serverResponse").innerHTML = "Response from server: " + pg.name + " successfully added.";
                        ClearTextFields();
                        GroupGrid.add_to_group_store(response);
                    },
                    error:function(error)
                    {
                        console.log("There was an error: \n"+error);
                        dom.byId("serverResponse").innerHTML = "Response from server: " + error;
                    }
                });
            }

            //ADD THE OBJECT TO THE STORE
            GroupGrid.add_to_group_store = function(pg)
            {
                var _pg = new Object(pg);
                var index = GroupMemStore.data.length;
                GroupMemStore.put(lang.mixin(
                    {id: index}, 
                    _pg
                )); 
            }

            //Removes an entire group from the database given the id of the row
            //of the selected group
            GroupGrid.removePG = function(selected)
            {
                if(!selected)
                    return;

                if(!selected[0]){ return alert('error deleting '+selected[0].name+' from Parameter Grid'); }
                if(!confirm("Are you sure you want to delete \'" + selected[0].name +"\'?"))
                    return;
                else
                {
                    xhr.get(
                    {
                        url:"/group",
                        content: 
                        {
                            action: 'remove_pg',
                            pg: JSON.stringify(selected[0]),
                            loaded: has_loaded=true,
                        },
                        load:function(response)
                        {
                            dom.byId("serverResponse").innerHTML = "Response from server: " + response;
                            remove_from_Group_store();
                        },
                        error:function(error)
                        {
                            console.log("There was an error: \n"+error);
                            dom.byId("serverResponse").innerHTML = "Response from server: " + error;
                        }
                    });
                }

                //REMOVE THE OBJECT FROM THE STORE
                remove_from_Group_store = function()
                {
                    GroupMemStore.remove(selected[0].id);
                }
            }

            GroupGrid.update_pg = function(pg)
            {
                var id = pg.id;
                delete pg.id;
                //send request to update an existing PG
                xhr.get(
                {
                    url:"/group", 
                    content: 
                    {
                        action: 'update_pg',
                        pg: JSON.stringify(pg),
                        loaded: has_loaded=true,
                    },
                    load:function(response)
                    {
                        alert(response);
                        dom.byId("serverResponse").innerHTML = "Response from server: " + pg.name + " successfully upated.";
                        ClearTextFields();
                        GroupMemStore.remove(id);
                        GroupGrid.add_to_group_store(pg);
                        groupGrid._refresh();
                        groupGrid.selection.clear();
                    },
                    error:function(error)
                    {
                        console.log("There was an error: \n"+error);
                        alert("There was an error: \n"+error);
                        dom.byId("serverResponse").innerHTML = "Response from server: " + error;
                    }
                });
            }


            //GETS AND RETURNS ALL THE PIs OF THE GIVEN PGs
            GroupGrid.getFieldsOfGroups = function(pgs)
            {
                //IF THE GIVEN ARRAY IS EMPTY, RETURN AN EMPTY ARRAY
                if(pgs.length < 1)
                {
                    return new Array();
                }

                //CREATE AN ARRAY TO STORE REALIZED PIs
                var parameters = [];

                //FOR EACH GROUP IN THE GIVEN PGs, MATCH THE PI IDs TO IDs IN THE STORE
                //IF A MATCH IS FOUND, ADD IT TO THE STORE AND MOVE TO THE NEXT PI
                for(var h = 0; h < pgs.length; h++)
                {   
                    //STORE THE CURRENT PG
                    var pg = pgs[h];

                    //IF THE PG IS NULL, BAIL
                    if(!pg)
                        return;

                    for(var i = 0; i < pg.members.length; i++)
                    {
                        //FLAGS IF A MATCH IS FOUND
                        var matched = false;
                        for(var j = 0; j < paramStore.data.length; j++)
                        {
                            if(matched)
                                break;
                            //TRY TO MATCH THE CURRENT PI ID TO AN ID IN THE STORE
                            if(pg.members[i] == paramStore.data[j]._id)
                            {
                                //IF THERE'S A MATCH, PUSH THE PI OBJECT TO THE ARRAY
                                parameters.push(paramStore.data[j]);
                                matched = true;
                            }
                        }
                    }
                    // for(var i = 0; i < pg.members.standard.length; i++)
                    // {
                    //     //FLAGS IF A MATCH IS FOUND
                    //     var matched = false;
                    //     for(var j = 0; j < paramStore.data.length; j++)
                    //     {
                    //         if(matched)
                    //             break;
                    //         //TRY TO MATCH THE CURRENT PI ID TO AN ID IN THE STORE
                    //         if(pg.members.standard[i] == paramStore.data[j]._id)
                    //         {
                    //             //IF THERE'S A MATCH, PUSH THE PI OBJECT TO THE ARRAY
                    //             parameters.push(paramStore.data[j]);
                    //             matched = true;
                    //         }
                    //     }
                    // }
                }
                return parameters;
            }

            /********************************      End Group Grid      ********************************/

            /********************************  **  **  **  **  **  **  ********************************/

            /********************************     Parameter Grid      *********************************/

            //OBJECT TO ASSOCIATE ALL FUNCTIONS AND PROPERTIES FOR THE FIXED PI GRID
            var ParamGrid = new Object();

            //BUILD THE GRID WITH THE GIVEN PARAMETERS
            ParamGrid.buildGrid = function()
            {
                //DEFINE THE LAYOUT
                var layout = [{type: 'dojox.grid._CheckBoxSelector'},[
                  {'name': 'Parameter', 'field': 'name', 'width': '100%'},
                ]];

                var parameters = fullDbMemStore.query({type: 'param_class'});
                paramStore.setData(parameters);

                //CREATE THE DOJO GRID AND RENDER IT
                var grid = new DataGrid({
                    store: paramDataStore,
                    structure: layout,
                selectionMode: 'multiple'}, 'ParamGrid');
                grid.startup(); //RENDER

                //REGISTER NOTIFY EVENT TO REFRESH THE GRID
                dojo.connect(paramStore, 'notify', function(){grid._refresh()});

                //UPDATE THE DIV AND THE SELECTION PROPERTY
                function reportSelection(node)
                {
                    ParamGrid.selected_fields = this.selection.getSelected();
                    if(ParamGrid.selected_fields.length > 0)
                    {
                        var msg = "You have selected " + ((ParamGrid.selected_fields.length > 1) ? " ": " ");
                    }
                    else
                        return;
                    var names = baseArray.map(ParamGrid.selected_fields, function(item)
                    {
                        return item.name;
                    }, this);
                    node.innerHTML = msg + names.join(", ");
                }

                //REGISTER SELECTION_CHANGE WITH REPORTSELECTION METHOD                
                grid.on("SelectionChanged", 
                    lang.hitch(grid, reportSelection, dom.byId("serverResponse")), true);

                //GLOBALIZE STORE DATA AND THE GRID
                window.paramGrid = grid;
            }

            /******************************     END PARAMETER GRID      *********************************/




            /******************************     STANDARD MEMBERS GRID      *********************************/

            var MembersGrid = {};

            MembersGrid.buildGrid = function(members)
            {
                //DEFINE THE LAYOUT
                var layout = [{type: 'dojox.grid._CheckBoxSelector'},[
                  {'name': 'Parameter', 'field': 'name', 'width': '100%'},
                ]];

                membersStore.setData(members);

                //CREATE THE DOJO GRID AND RENDER IT
                var grid = new DataGrid({
                    store: membersDataStore,
                    structure: layout,
                selectionMode: 'multiple'}, 'membersGrid');
                grid.startup(); //RENDER

                //REGISTER NOTIFY EVENT TO REFRESH THE GRID
                dojo.connect(membersStore, 'notify', function(){grid._refresh()});

                dojo.connect(grid, "SelectionChanged", function()
                {
                    console.log("Selection Changed");
                    MembersGrid.selected_fields = this.selection.getSelected();
                    console.log(MembersGrid.selected_fields);
                });

                //GLOBALIZE STORE DATA AND THE GRID
                window.membersGrid = grid;
            }

            /******************************     END STANDARD MEMBERS GRID      *********************************/


            /*******************************    BEGIN SELECTION GRID    ******************************/

            //OBJECT TO ASSOCIATE ALL FUNCTIONS AND PROPERTIES OF THE SELECTION GRID
            var SelectionGrid = new Object();
            
            /*  BUILD THE GRID GIVEN THE PIs AS A PARAMETER  */
            SelectionGrid.buildGrid = function(parameters)
            {
                /*  DEFINE LAYOUT  */
                var layout = [[
                  {'name': 'Parameter', 'field': 'name', 'width': '100%'},
                ]];

                /*  SET UP DATA STORE  */
                var selectionMemStore = new Memory({data: parameters, idProperty: '_id'});
                selectionMemStore = Observable(selectionMemStore);
                var selectionDataStore = new ObjectStore({
                    objectStore: selectionMemStore
                });


                /*  CREATE THE DOJO GRID AND RENDER IT  */
                var selectionGrid = new DataGrid({
                    store: selectionDataStore,
                    structure: layout,
                    selectionMode: 'single'}, "selectionGrid");
                selectionGrid.startup();

                /*  GLOBALIZE GRID PROPERTIES  */
                window.selectionGrid = selectionGrid;
                window.selectionMemStore = selectionMemStore;
            }

            SelectionGrid.removeParameterFromGroup = function(group, parameter)
            {
                selectionMemStore.remove(parameter._id);
                group.members = [];
                var store = selectionMemStore.data;
                for(var i = 0;i < store.length; i++)
                {
                    group.members.push(store[i]._id);
                }
                console.log(group);
                GroupGrid.update_pg(group);
            }

            /*  ON SELECTION CHANGE OF THE GROUP GRID, THE SELECTION GRID STORE IS REPOPULATED  */
            SelectionGrid.rebuildStore = function(parameters)
            {
                //IF THERE ARE NO PIs, GET OUT
                if(!parameters)
                    return;

                //CLEAR THE STORE
                selectionMemStore.setData(parameters);
                selectionGrid._refresh();
            }


            /********************************     End Selection Grid      *********************************/


            /********************************     Text Boxes, buttons, etc.      *********************************/


            //Group Name Textbox
            var txtBox_groupName = new TextBox({}, "txtBox_groupName");

            dojo.connect(txtBox_groupName, "onKeyUp", function(e)
            {
                if(e.keyCode == 13)
                    button_newPG.onClick();
            });


            //Confirm selection button for new group
            //require a name for the group
            var button_newPG = new Button(
            {
                label: 'Commit New',
                onClick: function()
                {
                    var group = {};
                    group.name = dom.byId('txtBox_groupName').value;
                    if(group.name < 1)
                    {
                        alert('A name is required for the new group.');
                        return;
                    }
                    if(membersStore.data.length < 1)
                    {
                        alert('You must add one or more parameters to the group.');
                        return;
                    }
                    group.members = [];
                    // group.members.standard = [];
                    // group.members.report = [];
                    for(var i = 0; i < membersStore.data.length; i++)
                    {
                        group.members.push(membersStore.data[i]._id);
                    }
                    GroupGrid.new_pg(group);
                }
            }, "button_newPG");

            //BUTTON USED TO ADD MEMBERS TO AN EXISTING GROUP
            var button_add_to_selected_group = new Button(
            {
                label: "Add To Selected",
                onClick: function()
                {
                    var selected = groupGrid.selection.getSelected();
                    var group = selected[0];
                    if(!group)
                        return alert("Select a group to add the paramters to.");
                    if(membersStore.data.length < 1)
                        return alert("There must be parameters in the 'Selected Members' grid");
                    for(var i = 0; i < membersStore.data.length; i++)
                    {
                        var matched = false;
                        mem_to_add = membersStore.data[i];
                        for(var j = 0; j < group.members.length; j++)
                        {
                            if(mem_to_add._id == group.members[j])
                                matched = true;
                        }
                        if(!matched)
                            group.members.push(mem_to_add._id);
                    }
                    console.log(group);
                    GroupGrid.update_pg(group);
                }
            }, "button_add_to_selected_group");


            //button to delete a selected group
            var button_delete_group = new Button(
                {
                    label: 'Delete', 
                    onClick: function()
                    {
                        GroupGrid.removePG(GroupGrid.selected_groups);
                    }
                }, "button_delete_group");

            //button to delete a selected parameter from the selected group
            var button_removeParameter = new Button(
                {
                    label: 'Delete', 
                    onClick: function()
                    {
                        var group = GroupGrid.selected_groups[0];
                        var selected_parameters = selectionGrid.selection.getSelected();
                        var parameter = selected_parameters[0];
                        SelectionGrid.removeParameterFromGroup(group, parameter);
                    }
                }, "button_removeParameter");

            var button_add_member = new Button(
                {
                    label: '-->', 
                    onClick: function()
                    {
                        var parameters = ParamGrid.selected_fields;
                        if(!parameters)
                            return;
                        for(var i = 0; i < parameters.length; i++)
                        {
                            var dependencies = parameters[i].members.dependencies;
                            addDependencies(dependencies);
                            try
                            {
                                membersStore.add(parameters[i]);
                            }
                            catch(error)
                            {console.log(parameters[i].name + ' is already in that set')};
                        }
                        membersGrid._refresh();
                        paramGrid.selection.clear();
                    }
                }, "button_add_member");

            //HELPER FUNCTION THAT ADDS ALL THE DEPENDENCIES OF A PARAMETER TO THE STANDARD
            //SECTION OF THE GRID AUTOMATICALLY.
            function addDependencies(dependencies)
            {
                for(var j = 0; j < dependencies.length; j++)
                {
                    var id = dependencies[j]._id;

                    for(var k = 0; k < paramStore.data.length; k ++)
                    {
                        var store_member = paramStore.data[k];
                        if(id == store_member._id)
                        try
                        {    
                            membersStore.add(store_member);
                        }
                        catch(error){}
                    }

                    addDependencies(dependencies[j].members.dependencies);
                }
            }

            //HELPER FUNCTION THAT ADDS ALL THE DEPENDENCIES OF A PARAMETER TO THE STANDARD
            //SECTION OF THE GRID AUTOMATICALLY.
            // function removeDependencies(dependencies)
            // {
            //     for(var j = 0; j < dependencies.length; j++)
            //     {
            //         var id = dependencies[j]._id;

            //         for(var k = 0; k < membersStore.data.length; k ++)
            //         {
            //             var store_member = membersStore.data[k];
            //             if(id == store_member._id)
            //             try
            //             {    
            //                 membersStore.remove(store_member._id);
            //             }
            //             catch(error){}
            //         }

            //         removeDependencies(dependencies[j].members.dependencies);
            //     }
            // }

            //button to remove selected report members
            var button_remove_member = new Button(
                {
                    label: '<--', 
                    onClick: function()
                    {
                        var mem_to_remove = membersGrid.selection.getSelected();
                        for(var i = 0;i < mem_to_remove.length; i++)
                        {
                            if(!mem_to_remove[i])
                                continue;
                            // var dependencies = mem_to_remove[i].members.dependencies;
                            // removeDependencies(dependencies);
                            membersStore.remove(mem_to_remove[i]._id);
                        }
                        membersGrid._refresh();
                    }
                }, "button_remove_member");

            //button to add selected members to standard members
            // var button_add_standard_member = new Button(
            //     {
            //         label: '-->', 
            //         onClick: function()
            //         {
            //             var members = ParamGrid.selected_fields;
            //             if(!members)
            //                 return;
            //             for(var i = 0; i < members.length; i++)
            //             {
            //                 var dependencies = members[i].members.dependencies;
            //                 addDependencies(dependencies);
            //                 try
            //                 {
            //                     standardMemStore.add(members[i]);
            //                 }
            //                 catch(error)
            //                 {console.log(members[i].name + ' is already in that set')};
            //             }
            //             standardMemGrid._refresh();
            //             paramGrid.selection.clear();
            //         }
            //     }, "button_add_standard_member");

            // //button to remove selected standard members
            // var button_remove_standard_member = new Button(
            //     {
            //         label: '<--', 
            //         onClick: function()
            //         {
            //             var mem_to_remove = standardMemGrid.selection.getSelected();
            //             for(var i = 0;i < mem_to_remove.length; i++)
            //             {
            //                 standardMemStore.remove(mem_to_remove[i]._id);
            //             }
            //             standardMemGrid._refresh();
            //         }
            //     }, "button_remove_standard_member");


            //HELPER FUNCTION TO CHECK IF AN OBJECT POSSESSES ANY PROPERTIES
            function objectIsEmpty(map) 
            {
               for(var key in map) 
               {
                  if (map.hasOwnProperty(key)) 
                  {
                     return false;
                  }
               }
               return true;
            }
            
            //CLEAR TEXT FIELDS AND GRID SELECTIONS
            function ClearTextFields()
            {
                dom.byId('txtBox_groupName').value = '';
                paramGrid.selection.clear();
                // standardMemStore.setData(new Array());
                // reportMemStore.setData(new Array());
                membersStore.setData(new Array());
                membersGrid._refresh();
                // standardMemGrid._refresh();
                // reportMemGrid._refresh();
            }

            GetFullDbStore();

        });
</script>
</head>

<!-- Layout -->
<body class="claro">
    <table width = '100%' border = "1">
        <col width = "45%">
        <col width = "18%">
        <col width = "35%">
        <tr> <!-- Labels -->
            <td style = "text-align: center; padding: 5px">
                <b>PG creator - Creates a New PG</b>
                <div style="text-align: right"><button id="button_add_to_selected_group"></button><button id = "button_newPG"></button></div>
            </td>
            <td style = "text-align: center; vertical-align: top; padding: 5px">
                <b>PG lister - Lists All PGs</b>
                <div style="text-align: right"><button id="button_delete_group"></button>
                </div>
            </td>
            <td style = "text-align: center; vertical-align: top; padding: 5px">
                <b>PG Viewer - Shows Selected PG</b>
                <div style="text-align: right">
                    <button id="button_removeParameter"></button>
                </div>
            </td>
        </tr>
        <tr> <!-- Grids -->
            <td valign = "top" style = "padding: 5px">
                <label for="txtBox_groupName" style = "padding: 5px">Name:</label><br>  
                <input id="txtBox_groupName" data-dojo-type="dijit/form/TextBox" style ="width: 50%;"></input>
                <br><br>
                <table width="100%">
                    <col width="47%">
                    <col width="6%">
                    <col width="47%">
                    <tr>
                        <td>
                            <div style="padding: 2px" align='center'><b>Parameter Classes</b></div>
                            <div id="ParamGrid"></div>
                        </td>
                        <td>
                            <div style="text-align: center; padding-top: 50px; padding-bottom: 50px"><button id = "button_add_member"></button></div>
                            <div style="text-align: center; padding-top: 50px; padding-bottom: 50px"><button id = "button_remove_member"></button></div>
                            <!-- <table width="100%">
                                <tr><div style="text-align: center; padding-top: 50px; padding-bottom: 50px"><button id = "button_add_member"></button></div></tr>
                                <tr><div style="text-align: center; padding-top: 50px; padding-bottom: 50px"><button id = "button_remove_standard_member"></button></div></tr>
                                <tr><div style="text-align: center; padding-top: 70px; padding-bottom: 50px"><button id = "button_add_report_member"></button></div></tr>
                                <tr><div style="text-align: center; padding-top: 50px; padding-bottom: 50px"><button id = "button_remove_member"></button></div></tr>
                            </table> -->
                        </td>
                        <td>
                            <div style="padding: 2px" align='center'><b>Selected Members</b></div>
                            <div id="membersGrid"></div>
                            <!-- <div style="padding: 2px" align='center'><b>Report Members</b></div>
                            <div id="reportMemGrid"></div> -->
                        </td>
                    </tr>
                </table>
            </td>
            <td valign = "top" style = "padding: 5px; text-align:right">
                <div id="GroupGridDiv"></div>
            </td>
            <td valign ="top" style = "padding: 5px">
                <div id="selectionGrid"></div>
            </td>
        </tr>
        <tr>
            <td colspan = '100%' style = "padding: 10px">
                <div id="serverResponse">Awaiting Action...</div>
            </td>
        </tr>
    </table>
</body>
</html>