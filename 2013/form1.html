<!DOCTYPE html>

<!--This is the Inventory Form-->

<!--Setup the page.  Load the dojo API-->
<html lang='en' style= 'background-color:#00FFFF'>
    <head>
        <h1 style="color:black; text-align:center">Inventory Manager</h1>
        <title>Inventory Manager</title>
    	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojo/resources/dojo.css">
    	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dijit/themes/claro/claro.css">
    	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojox/grid/resources/claroGrid.css">
         <style type="text/css">.dijitButtonNode { width:90px; } </style>
    	
        <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojo/dojo.js"
                        data-dojo-config="async: true, isDebug: true">
        </script>

        <!-- These are the form objects used in this page -->
        <script>

            require(["dojo/ready", 
                "dijit/form/Button", 
                "dojo/dom",
                'dijit/form/Select',
                'dijit/form/TextBox',
                'dijit/registry',
                'dijit/Dialog', 
                'dijit/form/ToggleButton', 
                'dojo/dom-style',
                'dojo/_base/xhr', 
                'dojo/_base/Deferred', 
                'dojo/domReady!'], 
                function(ready, Button, dom, Select, TextBox, registry, Dialog,
                    ToggleButton, domStyle, xhr, Deferred)
                {
                    ready(function()
                    {
                        //The SKU textbox
                        var txtBox_sku = registry.byId("txtBox_sku");

                        var txtBox_desc = registry.byId("txtBox_desc");

                        // The insert button:
                        var insertButton = new Button(
                        {
                            label: "Insert",
                            onClick: function()
                            {
                                if(dom.byId("txtBox_sku").value=="" || dom.byId("txtBox_desc").value =="")
                                {
                                     dom.byId("result1").innerHTML = "You must have both a SKU# and Description enetered";
                                }
                                else
                                {
                                    xhr.post(
                                    {
                                        url:"/form?Event=Insert&sku="+dom.byId("txtBox_sku").value+"&desc="+dom.byId("txtBox_desc").value,
                                        load:function(response)
                                        {
                                            dom.byId("result1").innerHTML = "Response from server: " + response;
                                        },

                                        error: function(error)
                                        {
                                            console.log("There was an error: \n"+error);
                                            dom.byId("result1").innerHTML = "Response from server: " + response;
                                        }
                                    });
                                }
                                console.log ("Insert button pressed.");
                                refreshList();
                              
                            }
                        }, "insertButton");
    
                        //The remove button
                        var removeButton = new Button(
                        {
                            label: "Remove",
                            onClick: function()
                            {
                                // dom.byId("result1").innerHTML += "You entered: " +
                                // dom.byId("txtBox_sku").value;
                                if(dom.byId("txtBox_sku").value=="" || dom.byId("txtBox_desc").value =="")
                                {
                                     dom.byId("result1").innerHTML = "Try entering something into both text boxes";
                                }
                                else
                                {
                                    xhr.get(
                                    {
                                        url:"/form?Event=Remove&sku="+dom.byId("txtBox_sku").value+"&desc="+dom.byId("txtBox_desc").value,
                                        load:function(response)
                                        {
                                            dom.byId("result1").innerHTML = "Response from server: " + response;
                                        },

                                        error:function(error)
                                        {
                                            console.log("There was an error: \n"+error);
                                            dom.byId("result1").innerHTML = "Response from server: " + response;
                                        }
                                    });
                                }
                                console.log ("Remove button pressed.");
                                refreshList();
                            }
                        }, "removeButton");

                        //This will refresh the inventory list
                        //It's set to refresh on page load
                        //and when changes are made to the inventory
                        function refreshList()
                        {
                            xhr.get(
                            {
                                url:"/form?Event=List",
                                load:function(response)
                                {
                                    console.log("inside refreshList load response: " + response);
                                    dom.byId("list").innerHTML = response;
                                },
                                error:function(error)
                                {
                                    console.log("Error getting list: " + error);
                                    dom.byId("list").innerHTML = "Error: " + response;
                                }
                            });
                            console.log("List refreshed");
                        }

                        //This call is to refresh the list on page
                        //load
                        refreshList();
                    });
                    
                });

        </script>
    </head>
    <body class="claro">
        <br>
        <!--This table is to handle page layout-->
        <table width = "400px" border = "0" ALIGN = center>
            <!--Text Boxes-->
            <tr>
                <td style="text-align:left;">
                    <label for="txtBox_sku">SKU#:</label><br>  
                    <input id="txtBox_sku" data-dojo-type="dijit/form/TextBox" style ="width: 80px;"></input>
                </td>
                <td style="text-align:left;">
                    <label for="txtBox_desc">Product Description:</label><br>  
                    <input id="txtBox_desc" data-dojo-type="dijit/form/TextBox" style ="width: 300px;"></input>
                </td>
            </tr>
            <!--Buttons-->
            <tr>
                <td colspan="2" style="text-align:center;">
                    <button id="insertButton" data-dojo-type="dijit/form/button"></button>
                    <button id="removeButton" data-dojo-type="dijit/form/button"></button>
                </td>
            </tr>
            <tr>
                <td colspan="2" style="text-align:center;">
                <div id="result1"></div>
                </td>
            </tr>
            <tr>
                <td colspan="2" style="text-align:center;">
                <h2> Current Inventory </h2>
                </td>
            </tr>
        </table>
        <div id = "list"><!--This is where the items get listed in the table--></div>
    </body>
</html>