<!-- parameter creator 2.0-->
<!-- This code was written by Alex Stout for Goal Zero, LLC private use -->
<!DOCTYPE html>

<html lang='en' style= 'background-color:#66FF99; padding: 0px 25px 25px'>
	<head>
        <title>Specs: Parameter Builder 2.0</title>
        <h1 ALIGN = 'center' style = 'padding: 10px'> Parameter: Individual </h1>
		 <!-- Load Dojo API -->
        
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojo/resources/dojo.css">
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dijit/themes/claro/claro.css">
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojox/grid/resources/claroGrid.css">

        <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojo/dojo.js"
                        data-dojo-config="async: true, isDebug: true">

        </script>

        <style type="text/css">@import "http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojox/grid/resources/claroGrid.css";
        #FixedGridDiv 
        {
            height: 52em;
            width: 100%;
        }
        #CompGrid
        {
            height: 52em;
            width: 100%;
        }
        #txtBox_paramDef
        {
            width: 97%;
        }
        #txtBox_paramOutput
        {
            width: 97%;
        }
        </style>

        <!-- parameter creator functions -->
        <script>

        var has_loaded = false; // tells the request handler if this page has already been loaded
        var fields = new Array(); //array to contain content returned

        	require(['dojo/_base/lang',
                "dojo/dom",
                'dijit/registry',
                'dijit/form/Button',
                "dojo/_base/array",
                'dojo/_base/xhr', 
                'dijit/form/TextBox',
                'dijit/InlineEditBox',
                'dojo/data/ItemFileWriteStore',
                'dojo/store/Observable',
                'dojox/grid/DataGrid',
                'dojo/store/Memory',
                'dojo/data/ObjectStore',
                'dojox/grid/_CheckBoxSelector',
                'dijit/form/CheckBox',
                'dijit/form/RadioButton',
                'dojox/grid/cells/dijit',
                'dijit/layout/ContentPane',
                'dojo/domReady!'], 
                function(lang, dom, registry, Button, baseArray, xhr, TextBox, InlineEditBox, ItemFileWriteStore, Observable, DataGrid, Memory, ObjectStore, _CheckBoxSelector, CheckBox, RadioButton, cells, CP)
                {
                    /********************************     Fixed PI Grid      *********************************/

                    //The FixedGrid is the grid that displays all the available fields from the database.
                    var FixedGrid = new Object();

                    //Get the parameters from the db
                    FixedGrid.getFields = function()
                    {
                        xhr.get(
                        {
                            url:'/parameter',
                            handleAs: 'json', //grabs the xhr string and turns it into an object
                            content:
                            {
                                action: 'getFields',
                                loaded: has_loaded = true,
                            },
                            load:function(response)
                            {
                                FixedGrid.allFields = response;
                                FixedGrid.buildGrid(FixedGrid.allFields); //rebuild the dojo Grid
                            },
                            error:function(error)
                            {
                                console.log("There was an error: " + error);
                                dom.byId("serverResponse").innerHTML = 'Response: ' + error;
                            }
                        });
                    }

                    //Removes an entire parameter from the database given the id of the row
                    //of the selected parameter
                    FixedGrid.removePI = function(selected)
                    {
                        if(!selected)
                            return;

                        if(!selected[0]){ return alert('error deleting '+selected[0].pi_name+' from Parameter Grid'); }
                        if(!confirm("Are you sure you want to delete \'" + selected[0].pi_name +"\'?"))
                            return;
                        else
                        {
                            xhr.get(
                            {
                                url:"/parameter",
                                content: 
                                {
                                    action: 'removeField',
                                    pi: JSON.stringify(selected[0]),
                                    loaded: has_loaded=true,
                                },
                                load:function(response)
                                {
                                    console.log("id to remove from mem store: " + selected[0].id);
                                    dom.byId("serverResponse").innerHTML = "Response from server: " + response;
                                    remove_from_fixed_store();
                                },
                                error:function(error)
                                {
                                    console.log("There was an error: \n"+error);
                                    dom.byId("serverResponse").innerHTML = "Response from server: " + error;
                                }
                            });
                        }

                        remove_from_fixed_store = function()
                        {
                            fixedMemStore.remove(selected[0].id);
                        }
                    }

                    FixedGrid.new_pi = function()
                    {
                        var pi = {
                            pi_name: dom.byId('txtBox_paramName').value,
                            pi_value: dom.byId('txtBox_paramValue').value,
                            pi_unit: dom.byId('txtBox_paramUnit').value,
                        };
                        //send request to create a new parameter
                        xhr.get(
                        {
                            url:"/parameter", 
                            handleAs: 'json',
                            content: 
                            {
                                action: 'new_pi',
                                pi: JSON.stringify(pi),
                                loaded: has_loaded=true,
                            },
                            load:function(response)
                            {
                                dom.byId("serverResponse").innerHTML = "Response from server: " + pi.pi_name + " successfully added.";
                                ClearTextFields();
                                add_to_fixed_store(response);
                            },
                            error:function(error)
                            {
                                console.log("There was an error: \n"+error);
                                dom.byId("serverResponse").innerHTML = "Response from server: " + error;
                            }
                        });

                        add_to_fixed_store = function(pi)
                        {
                            var pi = new Object(pi);
                            var index = fixedMemStore.data.length;
                            fixedMemStore.put(lang.mixin(
                                {id: index}, 
                                pi
                            )); 
                        }
                    }

                    FixedGrid.addValueToDefinition = function(pi_name)
                    {
                        var pair = new Object();
                        pair.f = pi_name;
                        pair.p = 'value';
                        FixedGrid.def_params.push(pair);
                        if(dom.byId('txtBox_paramDef').value == '')
                            var pairString = JSON.stringify(pair);
                        else if (dom.byId('txtBox_paramDef').value[dom.byId('txtBox_paramDef').value.length-1] == ';')
                            var pairString = JSON.stringify(pair);
                        else    
                            var pairString = ';' + JSON.stringify(pair);

                        var addThis = pairString; // This is the text string to add to the textbox
                        dom.byId('txtBox_paramDef').value += addThis; //append it to the textbox
                    }


                    FixedGrid.addUnitToDefinition = function(pi_name)
                    {
                        var pair = new Object();
                        pair.f = pi_name;
                        pair.p = 'unit';
                        FixedGrid.def_params.push(pair);
                        if(dom.byId('txtBox_paramDef').value == '')
                            var pairString = JSON.stringify(pair);
                        else if (dom.byId('txtBox_paramDef').value[dom.byId('txtBox_paramDef').value.length-1] == ';')
                            var pairString = JSON.stringify(pair);
                        else    
                            var pairString = ';' + JSON.stringify(pair);

                        var addThis = pairString; // This is the text string to add to the textbox
                        dom.byId('txtBox_paramDef').value += addThis; //append it to the textbox
                    }

                    //Build the Dojo Grid with the 
                    FixedGrid.buildGrid = function(fields)
                    {
                        FixedGrid.selected_fields;
                        FixedGrid.def_params = new Array(); //the elements of the definition string
                        FixedGrid.outputElements = new Array();

                        var data = [];

                        var layout = [[
                          {'name': '#', 'field': 'id', 'width': '5%'},
                          {'name': 'Parameter', 'field': 'pi_name', 'width': '45%'},
                          {'name': 'Value', 'field': 'pi_value', 'width': '20%'},
                          {'name': 'Unit', 'field': 'pi_unit', 'width': '20%'}
                        ]];

                        var fixedMemStore = new Memory({data: data}); //set up the store
                        fixedMemStore = Observable(fixedMemStore);
                        var fixedDataStore = new ObjectStore({
                            objectStore: fixedMemStore
                        });

                        //Fill the store with the retrieved DB data
                        for(var i = 0; i < fields.length; i++)
                        {
                            fixedMemStore.put(lang.mixin(
                                { id: i }, 
                                fields[i]
                            ));
                        }

                        /*create a new grid*/
                        var grid = new DataGrid({
                            store: fixedDataStore,
                            structure: layout}, 'FixedGridDiv');

                        /*Call startup() to render the grid*/
                        grid.startup();

                        dojo.connect(fixedMemStore, 'notify', function(){grid._refresh();});

                        //This function reports what fields are selected for the current working group
                        function reportSelection(node)
                        {
                            var items = this.selection.getSelected();
                            FixedGrid.selected_fields = items;
                            if(FixedGrid.selected_fields.length > 0)
                            {
                                var msg = "You have selected " + ((FixedGrid.selected_fields.length > 1) ? " ": " ");
                            }
                            else
                                var msg = "Nothing Selected";
                            
                            var pi_names = baseArray.map(items, function(item)
                            {
                                return item.pi_name;
                            }, this);
                            node.innerHTML = msg + pi_names.join(", ");
                        }
                        
                        //On selection change, call reportSelection() and pass in the response dom
                        grid.on("SelectionChanged", 
                            lang.hitch(grid, reportSelection, dom.byId("serverResponse")), true);

                        //On a cell double click, add the clicked property to the definition
                        dojo.connect(grid,"onCellDblClick", function(e)
                            {
                                var column = e.target.cellIndex;
                                var pi_name = fixedMemStore.get(e.rowIndex).pi_name;
                                if(column == 2)
                                    FixedGrid.addValueToDefinition(pi_name);
                                else if(column == 3)
                                    FixedGrid.addUnitToDefinition(pi_name);
                                else
                                    return;       
                            });

                        //make the following properties global
                        window.fixedData = fixedMemStore.data;
                        window.fixedGrid = grid;
                        window.fixedDataStore = fixedDataStore;
                        window.fixedMemStore = fixedMemStore;
                    }

                    /********************************     End of Fixed PI Grid      *********************************/

                    /********************************     Computed PI Grid      *********************************/

                    //The containing object for the Computed Grid
                    var CompGrid = new Object();

                    CompGrid.getSelected = function()
                    {
                        return this.selected_fields;
                    }

                    //Get the parameters from the db
                    CompGrid.getFields = function()
                    {
                        xhr.get(
                        {
                            url:'/parameter',
                            handleAs: 'json', //grabs the xhr string and turns it into an object
                            content:
                            {
                                action: 'getCompFields',
                                loaded: has_loaded = true,
                            },
                            load:function(response)
                            {
                                CompGrid.allFields = response;
                                CompGrid.buildGrid(CompGrid.allFields); //rebuild the dojo Grid
                            },
                            error:function(error)
                            {
                                console.log("There was an error: " + error);
                                dom.byId("serverResponse").innerHTML = 'Response: ' + error;
                            }
                        });
                    }

                    //Removes an entire parameter from the database given the id of the row
                    //of the selected parameter
                    CompGrid.removePI = function(selected)
                    {
                        if(!selected)
                            return;
                        if(!selected[0]){ return alert('error deleting '+selected[0].pi_name+' from CompGrid'); }
                        if(!confirm("Are you sure you want to delete \'" + selected[0].pi_name +"\'?"))
                            return;
                        else
                        {
                            xhr.get(
                            {
                                url:"/parameter",
                                content: 
                                {
                                    action: 'removeCompField',
                                    pi: JSON.stringify(selected[0]),
                                    loaded: has_loaded=true,
                                },
                                load:function(response)
                                {
                                    dom.byId("serverResponse").innerHTML = "Response from server: " + response;
                                    remove_from_comp_store();
                                },
                                error:function(error)
                                {
                                    console.log("There was an error: \n"+error);
                                    dom.byId("serverResponse").innerHTML = "Response from server: " + error;
                                }
                            });
                        }

                        remove_from_comp_store = function()
                        {
                            compMemStore.remove(selected[0].id);
                        }
                    }

                    //Called when the computed radio button is checked, the name, definition, and Output
                    //textboxes contain text and the conirm button is pressed.
                    CompGrid.new_pi = function()
                    {
                        var pi = {
                            pi_name: dom.byId('txtBox_paramName').value,
                            pi_def: dom.byId('txtBox_paramDef').value,
                        };
                        xhr.get(
                        {
                            url:"/parameter",
                            handleAs: 'json',
                            content: 
                            {
                                action: 'newCompField',
                                pi: JSON.stringify(pi),
                                loaded: has_loaded=true,
                            },
                            load:function(response)
                            {
                                dom.byId("serverResponse").innerHTML = "Response from server: '" + pi.pi_name + "' successfully added.";
                                ClearTextFields();
                                add_to_comp_store(response);
                            },
                            error:function(error)
                            {
                                console.log("There was an error: \n"+error);
                                dom.byId("serverResponse").innerHTML = "Response from server: " + error;
                            }
                        });

                        add_to_comp_store = function(pi)
                        {
                            var index = compMemStore.data.length;
                            compMemStore.put(lang.mixin(
                                    {id: index}, 
                                    new Object(pi)
                            ));
                        }
                    }

                    //Called when the definition cell is double clicked or the Get Property button is pressed.
                    CompGrid.addGridDefToDefinition = function(id)
                    {
                        item = compMemStore.get(id); //get the item by the given id
                        var def = item.pi_def[0];
                        if(dom.byId('txtBox_paramDef').value == '')
                            var addString = def;
                        else if (dom.byId('txtBox_paramDef').value[dom.byId('txtBox_paramDef').value.length-1] == ';')
                            var addString = def;
                        else    
                            var addString = ';' + def;

                        dom.byId('txtBox_paramDef').value += addString; //append it to the textbox
                    }

                    //Build the Dojo Grid with the 
                    CompGrid.buildGrid = function(fields)
                    {
                        CompGrid.selected_fields;
                        CompGrid.def_params = new Array(); //the elements of the definition string
                        CompGrid.outputElements = new Array();

                        //Grid Data
                        var data = [];

                        /*set up layout*/
                        var layout = [[
                          {'name': '#', 'field': 'id', 'width': '3%'},
                          {'name': 'Name', 'field': 'pi_name', 'width': '22%', 'editable': true, },
                          {'name': 'Definition', 'field': 'pi_def', 'width': '65%', }
                        ]];

                        var compMemStore = new Memory({data: data}); //set up the store
                        compMemStore = Observable(compMemStore);
                        var compDataStore = new ObjectStore({
                            objectStore: compMemStore
                        });

                        //Fill the store with the retrieved DB data
                        for(var i = 0; i < fields.length; i++)
                        {
                            compMemStore.put(lang.mixin(
                                { id: i }, 
                                fields[i] 
                            ));
                        }

                        /*create a new grid*/
                        var grid = new DataGrid({
                            store: compDataStore,
                            structure: layout}, 'CompGrid');

                        /*Call startup() to render the grid*/
                        grid.startup();
                        dojo.connect(compMemStore, 'notify', function(){grid._refresh();});

                        //This function reports what fields are selected for the current working group
                        function reportSelection(node)
                            {
                                var items = this.selection.getSelected();
                                CompGrid.selected_fields = items;
                                if(CompGrid.selected_fields.length > 0)
                                {
                                    var msg = "You have selected " + ((CompGrid.selected_fields.length > 1) ? " ": " ");
                                }
                                else
                                    var msg = "Nothing Selected";

                                var pi_names = baseArray.map(items, function(item)
                                {
                                    return item.pi_name;
                                }, this);
                                node.innerHTML = msg + pi_names.join(", ");
                            }

                        // Event for when the selections are changed, call reportselection on the dom id given
                        // hitch() returns a function that will execute a given function in a given context. 
                        // This function allows you 
                        // to control how a function executes, particularly in asynchronous operations
                        grid.on("SelectionChanged", 
                            lang.hitch(grid, reportSelection, dom.byId("serverResponse")), true);

                        dojo.connect(grid,"onCellDblClick", grid, function(e)
                            {
                                var column = e.target.cellIndex;
                                var pi_name = compMemStore.get(e.rowIndex).pi_name;
                                var def = e.target.textContent;
                                if(column == 2)
                                {
                                    if(dom.byId('txtBox_paramDef').value == '')
                                        var addString = def;
                                    else if (dom.byId('txtBox_paramDef').value[dom.byId('txtBox_paramDef').value.length-1] == ';')
                                        var addString = def;
                                    else    
                                        var addString = ';' + def;

                                    dom.byId('txtBox_paramDef').value += addString;
                                }
                                else
                                    return; 
                            });

                        window.compData = data;
                        window.compGrid = grid;
                        window.compDataStore = compDataStore;
                        window.compMemStore = compMemStore;
                    }

                    /********************************     End of Comp Field Grid      *********************************/

                    /********************************     Text Boxes, Buttons, etc      *********************************/

                     //input text boxes
                    var txtBox_paramName = registry.byId("txtBox_paramName");
                    var txtBox_paramValue = registry.byId("txtBox_paramValue");
                    var txtBox_paramUnit = registry.byId("txtBox_paramUnit");
                    var txtBox_paramDef = registry.byId("txtBox_paramDef");
                    var txtBox_paramOutput = registry.byId("txtBox_paramOutput");
                    document.getElementById('txtBox_paramOutput').readOnly = 'readOnly';

                    //Radio button that verifies entering a fixed pi
                    var radio_fixed= new RadioButton(
                        {
                            checked: true,
                            value: "fixed",
                            name: "pi_type",
                            onChange: function()
                            {
                                if(this.checked == true)
                                {
                                    dom.byId("fields_computed").style.display="none";
                                    dom.byId("fields_paramProperties").style.display = "block";
                                }
                                else
                                {
                                    dom.byId("fields_computed").style.display="block";
                                    dom.byId("fields_paramProperties").style.display = "none";
                                }
                            }

                        }, "radio_fixed");

                    //Radio button that verifies entering a computed pi
                    var radio_computed = new RadioButton(
                        {
                            checked: false,
                            value: "computed",
                            name: "pi_type",
                            onChange: function()
                            {
                                if(this.checked == true)
                                {
                                    dom.byId("fields_computed").style.display="block";
                                    dom.byId("fields_paramProperties").style.display = "none";
                                }
                                else
                                {
                                    dom.byId("fields_computed").style.display="none";
                                    dom.byId("fields_paramProperties").style.display = "block";
                                }
                            }
                        }, "radio_computed");

                    //Button that calls the function to delete the selected Comp parameter
                    var button_get_fixed_property = new Button(
                    {
                        label: 'Get Property', 
                        onClick: function()
                        {
                            if(!FixedGrid.selected_fields)
                                return alert("Select a Parameter from the grid first.\n\n\nTip:  Did you know Double Clicking a cell has the same affect?"); 
                            get_fixed_property(FixedGrid.selected_fields);
                        },
                    }, 'button_get_fixed_property');

                    //Gets the definition property of the selected computed pi
                    function get_fixed_property(selected)
                    {
                        var column = fixedGrid.focus.cell.index;
                        var pi_name = selected[0].pi_name;
                        if(column == 2)
                            FixedGrid.addValueToDefinition(pi_name);
                        else if(column == 3)
                            FixedGrid.addUnitToDefinition(pi_name);
                        else
                            return;       
                    }

                    //Button that calls the function that deletes the selected fixed parameter
                    var button_delete_fixed_pi = new Button(
                    {
                        label: 'Delete', 
                        onClick: function()
                        {
                            delete_fixed_pi(FixedGrid.selected_fields)
                        },
                    }, 'button_delete_fixed_pi');

                    //deletes the selected fixed parameter
                    function delete_fixed_pi(selected)
                    {
                        FixedGrid.removePI(selected);
                    }

                    //Button that calls the function to delete the selected Comp parameter
                    var button_get_comp_property = new Button(
                    {
                        label: 'Get Property', 
                        onClick: function()
                        {
                            if(!CompGrid.selected_fields)
                                return alert("Select a Parameter from the grid first.\n\n\nTip:  Did you know Double Clicking a cell has the same affect?"); 
                            get_comp_property(CompGrid.selected_fields);
                        },
                    }, 'button_get_comp_property');

                    //Gets the definition property of the selected computed pi
                    function get_comp_property(selected)
                    {

                        var def = selected[0].pi_def;
                        if(dom.byId('txtBox_paramDef').value == '')
                            var addString = def;
                        else if (dom.byId('txtBox_paramDef').value[dom.byId('txtBox_paramDef').value.length-1] == ';')
                            var addString = def;
                        else    
                            var addString = ';' + def;

                        dom.byId('txtBox_paramDef').value += addString;
                    }

                    //Button that calls the function to delete the selected Comp parameter
                    var button_delete_comp_pi = new Button(
                    {
                        label: 'Delete', 
                        onClick: function()
                        {
                            if(!CompGrid.selected_fields)
                                return alert("Select a Parameter from the grid first.\n\n\nTip:  Did you know Double Clicking a cell has the same affect?"); 
                            delete_comp_pi(CompGrid.selected_fields);
                        },
                    }, 'button_delete_comp_pi');
                    
                    //Deletes the selected computed parameter
                    function delete_comp_pi(selected)
                    {
                        CompGrid.removePI(selected);
                    }

                    //Button to Insert new parameter
                    var button_add_new_PI = new Button(
                    {
                        label: 'Confirm',
                        onClick: function()
                        {
                            //require the textbox to have something
                            if(dom.byId("txtBox_paramName").value=="")
                            {
                                 dom.byId("serverResponse").innerHTML = "Enter a name into the name field";
                            }
                            else if(dom.byId("txtBox_paramValue").value=="" && radio_computed.checked == false)
                            {
                                 dom.byId("serverResponse").innerHTML = "Enter a value into the value field";
                            }
                            else if(dom.byId("txtBox_paramUnit").value=="" && radio_computed.checked == false)
                            {
                                 dom.byId("serverResponse").innerHTML = "Enter a unit of measure into the UOM field";
                            }
                            else if(radio_computed.checked == true && dom.byId('txtBox_paramDef').value == "")
                            {
                                 dom.byId("serverResponse").innerHTML = "Enter a definition for the computed field";
                            }
                            else
                            {
                                if(!radio_computed.checked)
                                {
                                    FixedGrid.new_pi();
                                }
                                else
                                {
                                    CompGrid.new_pi();
                                }
                            }
                        }
                    }, 'button_add_new_PI');


                    /********  Currently Unused   ********/
                    //Confirm selection button for new group
                    //require a name for the group
                    var button_confirmUpdate = new Button(
                    {
                        label: 'Confirm Changes',
                        onClick: function()
                        {
                            var selectedParameter = FixedGrid.selected_fields;
                            var selectedType = 'fixed';
                            //store the selected group
                            var data = fixedData;
                            var specs = new Array();
                            
                            var i;
                            for(i = 0; i<data.items.length;i++)
                            {
                                var spec = new Object();
                                spec.pi_name = data[i].pi_name;
                                spec.pi_value = data[i].pi_value;
                                spec.pi_unit = data[i].pi_unit;
                                specs.push(spec);
                            }

                            var specString = JSON.stringify(specs);
                            
                            if(!selectedParameter)
                            {
                                dom.byId('serverResponse').innerHTML = 'You are required to select at least one group to form a product.';
                            }
                            else
                            {
                                xhr.get(
                                {
                                    url:"/parameter",
                                    content: 
                                    {
                                        action: 'update',
                                        parameter_name: selectedParameter,
                                        pi_type: selectedProductType,
                                        specs: specString,
                                        loaded: has_loaded=true,
                                    },
                                    load:function(response)
                                    {
                                        dom.byId("serverResponse").innerHTML = "Response from server: " + response;
                                        refresh();
                                    },
                                    error:function(error)
                                    {
                                        console.log("There was an error: \n"+error);
                                        dom.byId("serverResponse").innerHTML = "Response from server: " + error;
                                    }
                                });
                            }
                        }
                    }, "button_confirmUpdateSpecs");    

                    //button that calls the method to send the definition to the
                    //server for parsing
                    var button_ParseDefinition = new Button (
                    {
                        label: "Parse",
                        onClick: function()
                        {
                            parseDefinitionFieldToOutput();
                        }
                    }, "button_ParseDefinition");

                    //sends the definition to the server for parsing
                    function parseDefinitionFieldToOutput()
                    {
                        var definition = dom.byId("txtBox_paramDef").value;
                        xhr.get(
                        {
                            url:"/parameter",
                            content: 
                            {
                                action: 'parseDef',
                                definition: definition,
                                loaded: has_loaded=true,
                            },
                            load:function(response)
                            {
                                dom.byId('txtBox_paramOutput').value = response;
                            },
                            error:function(error)
                            {
                                console.log("There was an error: \n"+error);
                                dom.byId("serverResponse").innerHTML = "Response from server: " + error;
                            }
                        });
                    }

                    //Clear all the textboxes
                    function ClearTextFields()
                    {
                        dom.byId("txtBox_paramDef").value = "";
                        dom.byId("txtBox_paramOutput").value = "";
                        dom.byId("txtBox_paramName").value = "";
                        dom.byId("txtBox_paramValue").value = "";
                        dom.byId("txtBox_paramUnit").value = "";
                    }

                    //Retrieve data from the database, fill the grids, clear the text fields
                    function refresh()
                    {
                        FixedGrid.getFields();
                        CompGrid.getFields();
                        ClearTextFields();
                    }

                    //Do this on load
                    refresh();

                });
        </script>
    </head>

    <!-- Layout --> 
    <body class="claro"><table width = '100%' border = "1">
        <col width = "25%">
        <col width = "75%">
        <tr> <!-- Labels -->
            <td style = "text-align: center; padding: 5px">
                <b>Create New</b>
                    <div id = "newPIButtonDiv" style="text-align: right">
                        <button id="button_add_new_PI"></button>
                    </div>
            </td>
            <td style = "text-align: center; vertical-align: top; padding: 5px">
                <b>Parameter List</b>
            </td>
        </tr>
        <tr>
            <td valign = "top" style = "padding: 5px">
                <table>
                    <tr>
                        <td style = "padding: 5px">
                            <div style = "padding: 2px">
                            <input id = "radio_fixed"><label for = "radio_fixed">Fixed</label></div>
                            <div style = "padding: 2px">
                            <input id = "radio_computed"><label for = "radio_computed">Computed</label><br><br></div>
                            <label for="txtBox_paramName" style = "padding: 5px">Name:</label><br>  
                            <input id ='txtBox_paramName' data-dojo-type="dijit/form/TextBox"> </input><br>
                        </td>
                    </tr>
                </table>
                <div id = "fields_paramProperties" style = "display: block">
                    <table width = '100%' border = '0'>
                        <tr>
                            <td style = "padding: 5px">
                                <label for="txtBox_paramValue" style = "padding: 5px">Value:</label><br>  
                                <input id ='txtBox_paramValue' data-dojo-type="dijit/form/TextBox"> </input><br>
                            </td>
                        </tr>
                        <tr>
                            <td style = "padding: 5px">
                                <label for="txtBox_paramUnit" style = "padding: 5px">Units:</label><br>  
                                <input id ='txtBox_paramUnit' data-dojo-type="dijit/form/TextBox"> </input><br>
                            </td>
                        </tr>
                    </table>
                </div>
                <br><br>
                <div id = "fields_computed" style = "display: none">
                    <table width = '100%' border = '0'>
                        <tr>
                            <td style = "padding: 5px">
                                <label for="txtBox_paramDef" style = "padding: 5px">Definition:</label><br>
                                <input id = "txtBox_paramDef" data-dojo-type="dijit/form/TextBox"></input>
                                <div id = "ParseButtonDiv" style="text-align: right; padding: 10px">
                                    <button id="button_ParseDefinition"></button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td style = "padding: 5px">
                                <label for="txtBox_paramOutput" style = "padding: 5px">Output:</label><br>  
                                <input id = "txtBox_paramOutput" data-dojo-type="dijit/form/TextBox"></input>
                            </td>
                        </tr>
                    </table>
                </div>
                
            </td>
            <td valign = "top" style = "padding: 2px; text-align:right">
                <table width = '100%' border = '0'>
                    <col width = '30%'>
                    <col width = '70%'>
                    <tr>
                        <td valign = "top" style = "padding: 2px;">
                            <div id = "CompGridTitle" style = "text-align:center"><p><b>Fixed Parameters</b></p></div>
                            <div id = "deleteFPIdiv" style="text-align: right">
                                <button id="button_get_fixed_property"></button>
                                <button id="button_delete_fixed_pi"></button>
                            </div>
                            <div id="FixedGridDiv"></div>
                        </td>
                        <td valign = "top" style = "padding: 2px;">
                            <div id = "CompGridTitle" style = "text-align:center"><p><b>Computed Parameters</b></p></div>
                            <!-- <div id = "deleteCPIdiv" style="text-align: right"> -->
                                <button id="button_get_comp_property"></button>
                                <button id="button_delete_comp_pi"></button>
                            <!-- </div> -->
                            <div id="CompGrid"></div>
                            <br><br>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td colspan = "100%" style = "padding: 10px">
                <div id="serverResponse">Status: Awaiting action...</div>
            </td>
        </tr>
    </table>
    </body> 
</html>