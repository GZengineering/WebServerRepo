<!-- group builder -->
<!DOCTYPE html>

<html lang='en' style= 'background-color:#00FFFF; padding: 20px 50px 50px'>
    <head>
         <!-- Load Dojo API -->
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojo/resources/dojo.css">
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dijit/themes/claro/claro.css">
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojox/grid/resources/claroGrid.css">

        <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.8.3/dojo/dojo.js"
                        data-dojo-config="async: true, isDebug: true">
        </script>

        <!-- parameter creator functions -->
        <script>

        var has_loaded = false;
        

            require(["dojo/ready",
                "dojo/dom",
                'dijit/registry',
                'dijit/form/Button',
                'dojo/_base/xhr', 
                'dijit/form/TextBox',
                'dojox/grid/DataGrid',
                'dojo/data/ItemFileWriteStore',
                'dojo/domReady!'], 
                function(ready, dom, registry, Button, xhr, TextBox, DataGrid)
                {
                    // var groups = new Array();
                    // var group = new Array();
                    //do this
                    ready(function()
                    {
                        // function addToGroup(field)
                        // {
                        //     group.push(field);
                        //     console.log('\n');
                        //     for(i = 0; i < group.length; i++)
                        //         console.log('Group element: ' + group[i]);
                        // }
                        //requests an update on the contents of the table 
                        function getFields()
                        {
                            xhr.get(
                            {
                                url:'/group',
                                handleAs: 'json', //grabs the xhr string and turns it into an object
                                content:
                                {
                                    action: 'getFields',
                                    loaded: has_loaded = true,
                                },
                                load:function(response)
                                {
                                    fields = response;
                                    buildTable(fields); //rebuild the html table
                                },
                                error:function(error)
                                {
                                    console.log("There was an error: " + error);
                                    dom.byId("serverResponse").innerHTML = 'Response: ' + error;
                                }
                            });
                        }

                        // Build the table based on the contents returned from the handler
                        function buildTable(fields)
                        {
                            fields = fields.sort();
                            var table_html_string;
                            //If there are some existing fields, build a table of them
                            if(fields.length > 0)
                            {
                                table_html_string = "<table width = '250px' border = '1'>" +
                                '<tr>' +
                                '<td style = "background-color:#E0E0E0; text-align:center"> <b>Available Fields</b>' +
                                '</td>' +
                                '</tr>';
                                for(i = 0; i < fields.length; i++)
                                {
                                    table_html_string += '<tr>' +
                                    '<div id = "field"'+i+'><td style = "background-color:#F0F0F0; width:90px; vertical-align:top;">' +
                                    '<a href = "#" onclick="Group.addToGroup('+fields[i].field_name+'); return false">' + fields[i].field_name + '</a>' +
                                    '</td></div>' + 
                                    '</tr>';
                                }
                                table_html_string += '</table>';
                                
                            }
                            //otherwise build a table and clarify there are no fields available
                            else
                            {
                                table_html_string = "<table width = '250px' border = '1'>" +
                                '<tr>' +
                                '<td style = "background-color:#E0E0E0; text-align:center"> <b>Available Fields</b>' +
                                '</td>' +
                                '</tr>' +
                                '<tr>' +
                                '<td style = "background-color:#F0F0F0; width:90px; vertical-align:top;" ALIGN = center>' +
                                '<b> There Are No Fields Available </b>' +
                                '</td></tr>' +
                                '</table>';
                            }
                            dom.byId('fieldList').innerHTML = table_html_string;
                            console.log ("List refreshed");
                        }
                        //refreshes the contents on page load
                        getFields();
                    });
                });
        </script>
    </head>

    <!-- Layout --> 
    <body class="claro">
        <div id = 'fieldList'></div> <!-- The table that displays the available fields -->
        <div id = 'serverResponse'></div> <!-- The server response string string -->
    </body> 
</html>